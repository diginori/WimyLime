<html>
  <head>
    <meta http-equiv="content-type" content="text/html; charset=utf-8"/>
    <title>WimyLime Recorder</title>
    <link href="style.css" rel="stylesheet" type="text/css"/>

    <script src="util.js"></script>
    <script src="common.js"></script>
    <script>
    var keytyped = false;
    var keylog = "";
    
    var notePad1 = [];
    var notePad2 = [];
    var notePad3 = [];
    var notePad4 = [];
    
    function getCurrentYoutubeTimeString()
    {
    	if ( g_youtubePlayer == null )
    	{
        	return 0.0;
    	}
    	else
    	{
        	return getFixedYoutubeCurrentTime();
    	}
    }
    
    function onGamePad1()
    {
    	notePad1.push(getCurrentYoutubeTimeString());
    	generateResult();
    }
    
    function onGamePad2()
    {
    	notePad2.push(getCurrentYoutubeTimeString());
    	generateResult();
    }
    
    function onGamePad3()
    {
    	notePad3.push(getCurrentYoutubeTimeString());
    	generateResult();
    }
    
    function onGamePad4()
    {
    	notePad4.push(getCurrentYoutubeTimeString());
    	generateResult();
    }
    
    function makeNote(key, arr)
    {
		var note = "\"" + key + "\" : [ ";
		
		for ( var i=0; i<arr.length; ++i )
		{
			if ( i != 0 )
			{
				note += ", ";
			}
			note += arr[i].toString();
		}
		
		note += "]";
		if ( key != "pad4" )
		{
			note += ",";
		}
		
		return note;
    }
    
    function generateResult()
    {
    	var logDiv = document.getElementById("taOutput");

    	var keylog = "{";
    	
    	keylog += makeNote("pad1", notePad1);
    	keylog += makeNote("pad2", notePad2);
    	keylog += makeNote("pad3", notePad3);
    	keylog += makeNote("pad4", notePad4);
    	
    	keylog += "}";
    	logDiv.value = keylog;
    }

    function draw()
    {
    	var canvas = document.getElementById("mycanvas");
    	
    	if ( canvas == null ) return;
    	var context = canvas.getContext("2d");
    	
    	context.clearRect(0, 0, CANVAS_WIDTH, CANVAS_HEIGHT);
    	context.fillStyle = "rgb(150,150,150)";
    	
    	if ( keytyped )
    	{
    		context.fillStyle = "rgb(255,255,255)";
    		keytyped = false;
    	}
    	
    	context.fillRect(0,0,CANVAS_WIDTH, CANVAS_HEIGHT);
    }
    
    function fillData()
    {
    	var vars = getUrlVars();
    	
    	var videoID = getVideoID();
    	var author = vars["author"];
    	
    	$("videoid").value = videoID;
    	$("author").value = author;
    	$("show_author").innerHTML = author;
		request("/getVideoTitle.py?videoid=" + videoID,
				function(responseJSON)
				{
					var title = responseJSON["title"];
					
					$("videotitle").value = title;
					$("show_title").innerHTML = title;
				}, null);

    }
    
    startMainLoop(draw);
    </script>
    
    <script src="http://www.google.com/jsapi" type="text/javascript"></script>
    <script src="recorder.js" type="text/javascript"></script>
  </head>
  <body>
  	<div id="allcontent">
  		<div>
  			<p>
  				<span id="show_title">타이틀 검색 중...</span><br />
  				<span id="show_author">...</span>
  			</p>
  		</div>
	    <div id="videoDiv">Loading...</div>
	    <br />
	    <canvas id="mycanvas" width="480" height="300"></canvas>
	    <div id="controller">
			<table id="inputTable">
				<tr>
					<td id="inputPad1"></td>
					<td id="inputPad2"></td>
					<td id="inputPad3"></td>
					<td id="inputPad4"></td>
				</tr>
			</table>
		</div>
		<script>
		document.getElementById("inputPad1").addEventListener("touchstart", onTouchPad1, false);
		document.getElementById("inputPad2").addEventListener("touchstart", onTouchPad2, false);
		document.getElementById("inputPad3").addEventListener("touchstart", onTouchPad3, false);
		document.getElementById("inputPad4").addEventListener("touchstart", onTouchPad4, false);
		
		document.getElementById("inputPad1").addEventListener("touchend", onTouchPadEnd1, false);
		document.getElementById("inputPad2").addEventListener("touchend", onTouchPadEnd2, false);
		document.getElementById("inputPad3").addEventListener("touchend", onTouchPadEnd3, false);
		document.getElementById("inputPad4").addEventListener("touchend", onTouchPadEnd4, false);
		</script>
	    
	    <br />
	    
		<div >
			<form action="insertLime.py" method="post">
			<input type="hidden" name="videoid" id="videoid">
			<input type="hidden" name="videotitle" id="videotitle">
			<input type="hidden" name="author" id="author">
			<textarea  style="display:none;" id="taOutput" name="notes"></textarea>
			<input type="submit" onclick="requestSubmit">
			</form>
		</div>
  	</div>

    <div id="result" style="display:none;"></div>
    <div id="output" style="display:none;"></div>

	<script>
    fillData();

	</script>

    <script src="youtube.js" type="text/javascript"></script>
    <script>
    playYouTubeWhenReady(getVideoID());
    </script>
  </body>
</html>
​